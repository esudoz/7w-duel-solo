<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="manifest" href="./manifest.webmanifest">

<title>7W Duel Solo</title>

<style>
:root{
  --bg:#0f1115;
  --panel:#161a22;
  --border:rgba(255,255,255,.15);
  --text:rgba(255,255,255,.92);
  --muted:rgba(255,255,255,.65);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,system-ui}
body{padding:12px}

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:14px;
  padding:10px 12px;
  margin-bottom:12px
}
select,button{
  background:#222;
  border:1px solid var(--border);
  color:var(--text);
  border-radius:10px;
  padding:8px 12px
}

.app{
  display:grid;
  grid-template-columns:1.1fr 1fr;
  gap:12px;
  height:calc(100% - 72px)
}
.panel{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:16px;
  padding:12px;
  position:relative
}

/* ===== 왼쪽 오토마 ===== */
.automaPanel{
  display:flex;
  align-items:center;
  justify-content:center;
}
.automaImg{
  height:100%;
  max-height:100%;
  width:auto;          /* 좌우 여백 허용 */
  max-width:100%;
  object-fit:contain;
}

/* ===== 오른쪽 ===== */
.rightWrap{
  display:grid;
  grid-template-rows:1fr 1fr;
  gap:12px;
  height:100%;
  overflow:visible;
}

/* 카드 공통 (가로 카드) */
.card{
  width:min(90%,360px);
  aspect-ratio:16 / 9;
  border-radius:14px;
  background-size:cover;
  background-position:center;
  border:1px solid rgba(255,255,255,.18);
  box-shadow:0 18px 40px rgba(0,0,0,.45)
}

/* ===== 카드 더미 ===== */
.stackArea{
  position:relative;
  height:100%;
  border:1px dashed rgba(255,255,255,.25);
  border-radius:14px;
  overflow:visible;
  touch-action:none
}
.stackHint{
  position:absolute;
  top:10px;
  left:10px;
  font-size:13px;
  color:var(--muted)
}
.stackCount{
  position:absolute;
  top:10px;
  right:10px;
  font-size:13px;
  color:var(--muted)
}

.cardBack{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  background-image:url("./assets/cards/back.png")
}
.cardBack:nth-child(3){
  transform:translate(-50%,-50%) translate(6px,6px);
  opacity:.6
}
.cardBack:nth-child(4){
  transform:translate(-50%,-50%) translate(-4px,4px);
  opacity:.8
}

/* 드래그 카드 (항상 뒷면) */
.topCard{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  background-image:url("./assets/cards/back.png");
  cursor:grab;
  touch-action:none;
  z-index:50;
}

/* ===== 드롭존 ===== */
.dropZone{
  position:relative;
  height:100%;
  border:1px dashed rgba(255,255,255,.3);
  border-radius:14px;
  display: grid !important;
  place-items: center !important;
  z-index:1;
}
.dropHint{
  color:var(--muted);
  font-size:13px;
  text-align:center
}
.placedCard{
  position:absolute;
  inset:10px;
  display:none;

  background-repeat: no-repeat;
  background-position: center;
  background-size: contain;  /* 가로 카드면 전체 보이게 */
}
</style>
</head>

<body>
<header>
  <div>7원더스 대결 · 솔로</div>
  <div>
    <select id="automaSelect"></select>
    <button id="resetBtn">셔플</button>
  </div>
</header>

<main class="app">
  <!-- 왼쪽 오토마 -->
  <section class="panel automaPanel">
    <img id="automaImg" class="automaImg">
  </section>

  <!-- 오른쪽 -->
  <section class="rightWrap">
    <div class="panel stackArea" id="stackArea">
      <div class="stackHint">아래로 끌기</div>
      <div class="stackCount" id="stackCount"></div>

      <div class="card cardBack"></div>
      <div class="card cardBack"></div>
      <div class="card cardBack"></div>

      <div class="card topCard" id="topCard"></div>
    </div>

    <div class="panel dropZone" id="dropZone">
      <div class="dropHint" id="dropHint">여기에 놓으면<br>앞면 공개</div>
      <div class="card placedCard" id="placedCard"></div>
    </div>
  </section>
</main>

<script>
const AUTOMAS=[
 {n:"HAMMURABI",s:"./assets/automa/HAMMURABI.png"},
 {n:"CLEOPATRA",s:"./assets/automa/CLEOPATRA.png"},
 {n:"CAESAR",s:"./assets/automa/CAESAR.png"},
 {n:"ARISTOTLE",s:"./assets/automa/ARISTOTLE.png"},
 {n:"BILKIS",s:"./assets/automa/BILKIS.png"}
];
const CARDS=[...Array(12)].map((_,i)=>`./assets/cards/${i+1}.png`);

let deck=[],idx=0,drag=false,sx=0,sy=0;
const $=id=>document.getElementById(id);

function shuffle(a){
 for(let i=a.length-1;i>0;i--){
  const j=Math.floor(Math.random()*(i+1));
  [a[i],a[j]]=[a[j],a[i]];
 }
 return a;
}

function reset(){
 deck=shuffle(CARDS);
 idx=0;
 $("placedCard").style.display="none";
 $("dropHint").style.display="block";
 $("topCard").style.display="block";
 $("stackCount").textContent=`${deck.length}장`;
 $("topCard").style.transform="translate(-50%,-50%)";
}

AUTOMAS.forEach(a=>{
 const o=document.createElement("option");
 o.value=a.s;
 o.textContent=a.n;
 $("automaSelect").appendChild(o);
});
$("automaImg").src=AUTOMAS[0].s;
$("automaSelect").onchange=e=>$("automaImg").src=e.target.value;
$("resetBtn").onclick=reset;

$("topCard").onpointerdown=e=>{
 drag=true;
 sx=e.clientX;
 sy=e.clientY;
 $("topCard").setPointerCapture(e.pointerId);
};

window.onpointermove=e=>{
 if(!drag)return;
 $("topCard").style.transform=
  `translate(calc(-50% + ${e.clientX-sx}px),
             calc(-50% + ${e.clientY-sy}px))`;
};

window.onpointerup=()=>{
 if(!drag)return;
 drag=false;

 const c=$("topCard").getBoundingClientRect();
 const d=$("dropZone").getBoundingClientRect();
 const cx = c.left + c.width / 2;
 const cy = c.top  + c.height / 2;
  
 const hit =
   cx >= d.left && cx <= d.right &&
   cy >= d.top  && cy <= d.bottom;

 if(hit){
   $("placedCard").style.backgroundImage=`url(${deck[idx++]})`;
   $("placedCard").style.display="block";
   $("dropHint").style.display="none";
   $("stackCount").textContent=`${deck.length-idx}장`;
   if(idx>=deck.length) $("topCard").style.display="none";
 }
 $("topCard").style.transform="translate(-50%,-50%)";
};

reset();
</script>
</body>
</html>
